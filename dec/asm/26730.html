<!DOCTYPE html>
<html>
<head>
<title>Hungry Horace: Routine at 26730</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Hungry Horace" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="26657.html">26657</a></span></td>
<td class="up">Up: <a href="../maps/all.html#26730">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="26887.html">26887</a></span></td>
</tr>
</table>
<div class="description">26730: Draw the bell and check whether Horace has sounded the alarm</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Called from the main loop at <a href="25129.html">25129</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="26730"></span>26730</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,(<a href="31851.html">31851</a>)</td>
<td class="comment-11" rowspan="1">Pick up Horace's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26733"></span>26733</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,(<a href="31940.html">31940</a>)</td>
<td class="comment-11" rowspan="1">Pick up the location of the bell in the current maze.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26737"></span>26737</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="2">Has Horace already sounded the alarm?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26738"></span>26738</td>
<td class="bytes-0"></td>
<td class="instruction">OR C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26739"></span>26739</td>
<td class="bytes-0"></td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26740"></span>26740</td>
<td class="bytes-0"></td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Clear the carry flag. (This instruction is redundant.)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26741"></span>26741</td>
<td class="bytes-0"></td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">Subtract the bell's location from Horace's.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26743"></span>26743</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="2">Is Horace in exactly the same location as the bell?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26744"></span>26744</td>
<td class="bytes-0"></td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26745"></span>26745</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="26730.html#26814">26814</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26747"></span>26747</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="3">Is Horace one space to the left of the bell?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26748"></span>26748</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26749"></span>26749</td>
<td class="bytes-0"></td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26750"></span>26750</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="26730.html#26814">26814</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26752"></span>26752</td>
<td class="bytes-0"></td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="4">Is Horace one space to the right of the bell?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26753"></span>26753</td>
<td class="bytes-0"></td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26754"></span>26754</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26755"></span>26755</td>
<td class="bytes-0"></td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26756"></span>26756</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="26730.html#26814">26814</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26758"></span>26758</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,33</td>
<td class="comment-11" rowspan="4">Is Horace one space above the bell?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26761"></span>26761</td>
<td class="bytes-0"></td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26762"></span>26762</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26763"></span>26763</td>
<td class="bytes-0"></td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26764"></span>26764</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="26730.html#26814">26814</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26766"></span>26766</td>
<td class="bytes-0"></td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">Clear the carry flag. (This instruction is redundant.)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26767"></span>26767</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,65</td>
<td class="comment-11" rowspan="4">Is Horace one space below the bell?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26770"></span>26770</td>
<td class="bytes-0"></td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26772"></span>26772</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26773"></span>26773</td>
<td class="bytes-0"></td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26774"></span>26774</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="26730.html#26814">26814</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="26776"></span>
<div class="comments">
<div class="paragraph">
Horace has not sounded the alarm.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26776"></span>26776</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,(<a href="31940.html">31940</a>)</td>
<td class="comment-11" rowspan="1">Pick up the location of the bell in the current maze.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26779"></span>26779</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(<a href="31942.html">31942</a>)</td>
<td class="comment-11" rowspan="3">Increment the bell's animation frame counter.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26782"></span>26782</td>
<td class="bytes-0"></td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26783"></span>26783</td>
<td class="bytes-0"></td>
<td class="instruction">LD (<a href="31942.html">31942</a>),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26786"></span>26786</td>
<td class="bytes-0"></td>
<td class="instruction">AND 56</td>
<td class="comment-11" rowspan="1">Keep only bits 3, 4 and 5.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26788"></span>26788</td>
<td class="bytes-0"></td>
<td class="instruction">CP 31</td>
<td class="comment-11" rowspan="1">Is the result 30 or less (i.e. bit 5 reset)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26790"></span>26790</td>
<td class="bytes-0"></td>
<td class="instruction">JR C,<a href="26730.html#26794">26794</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26792"></span>26792</td>
<td class="bytes-0"></td>
<td class="instruction">XOR 56</td>
<td class="comment-11" rowspan="1">Flip bits 3 and 4, and reset bit 5.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="26794"></span>26794</td>
<td class="bytes-0"></td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="4"><span class="register">BC</span>=4*<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26795"></span>26795</td>
<td class="bytes-0"></td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26796"></span>26796</td>
<td class="bytes-0"></td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26797"></span>26797</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26799"></span>26799</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,<a href="32519.html">32519</a></td>
<td class="comment-11" rowspan="1">This is the base address of the graphic data for the bell.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26802"></span>26802</td>
<td class="bytes-0"></td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="3">Point <span class="register">DE</span> at the graphic data for the appropriate bell sprite.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26803"></span>26803</td>
<td class="bytes-0"></td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26804"></span>26804</td>
<td class="bytes-0"></td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26805"></span>26805</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="27663.html">27663</a></td>
<td class="comment-11" rowspan="1">Set <span class="register">HL'</span> to the attribute file address of the bell's location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26808"></span>26808</td>
<td class="bytes-0"></td>
<td class="instruction">LD C,58</td>
<td class="comment-11" rowspan="1">This is the attribute byte (INK 2: PAPER 7).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26810"></span>26810</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="27606.html">27606</a></td>
<td class="comment-11" rowspan="1">Draw the bell.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26813"></span>26813</td>
<td class="bytes-0"></td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="26814"></span>
<div class="comments">
<div class="paragraph">
Horace has sounded the alarm.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="26814"></span>26814</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,0</td>
<td class="comment-11" rowspan="2">Clear the bell location to indicate that Horace has sounded the alarm.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26817"></span>26817</td>
<td class="bytes-0"></td>
<td class="instruction">LD (<a href="31940.html">31940</a>),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26820"></span>26820</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,<a href="32647.html">32647</a></td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the graphic data for the blank sprite.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26823"></span>26823</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,(<a href="28623.html#28625">28625</a>)</td>
<td class="comment-11" rowspan="1">Pick up the bell location for the current maze.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26826"></span>26826</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="27663.html">27663</a></td>
<td class="comment-11" rowspan="1">Set <span class="register">HL'</span> to the corresponding attribute file address.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26829"></span>26829</td>
<td class="bytes-0"></td>
<td class="instruction">LD C,62</td>
<td class="comment-11" rowspan="1">This is the attribute byte (INK 6: PAPER 7).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26831"></span>26831</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="27606.html">27606</a></td>
<td class="comment-11" rowspan="1">Draw the blank sprite where the bell was.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26834"></span>26834</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="26657.html">26657</a></td>
<td class="comment-11" rowspan="1">Draw Horace.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26837"></span>26837</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,(<a href="31859.html">31859</a>)</td>
<td class="comment-11" rowspan="4">Add 60 to the score.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26840"></span>26840</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,60</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26843"></span>26843</td>
<td class="bytes-0"></td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26844"></span>26844</td>
<td class="bytes-0"></td>
<td class="instruction">LD (<a href="31859.html">31859</a>),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26847"></span>26847</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="26017.html#26055">26055</a></td>
<td class="comment-11" rowspan="1">Print the new score and make a sound effect.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26850"></span>26850</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(<a href="31842.html">31842</a>)</td>
<td class="comment-11" rowspan="1">Pick up the game speed parameter in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26853"></span>26853</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,0</td>
<td class="comment-11" rowspan="4"><span class="register">HL</span>=128*<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26855"></span>26855</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26856"></span>26856</td>
<td class="bytes-0"></td>
<td class="instruction">SRA H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26858"></span>26858</td>
<td class="bytes-0"></td>
<td class="instruction">RR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26860"></span>26860</td>
<td class="bytes-0"></td>
<td class="instruction">LD (<a href="28078.html">28078</a>),HL</td>
<td class="comment-11" rowspan="1">Initialise the guard panic timer to this value.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26863"></span>26863</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(<a href="28088.html#28090">28090</a>)</td>
<td class="comment-11" rowspan="4">Update the animation frame in the temporary guard buffer; these instructions are redundant and have no effect on any of the guards.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26866"></span>26866</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26868"></span>26868</td>
<td class="bytes-0"></td>
<td class="instruction">AND 3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26870"></span>26870</td>
<td class="bytes-0"></td>
<td class="instruction">LD (<a href="28088.html#28090">28090</a>),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26873"></span>26873</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,(<a href="31859.html">31859</a>)</td>
<td class="comment-11" rowspan="4">Add 150 to the score.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26876"></span>26876</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,150</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26879"></span>26879</td>
<td class="bytes-0"></td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26880"></span>26880</td>
<td class="bytes-0"></td>
<td class="instruction">LD (<a href="31859.html">31859</a>),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26883"></span>26883</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="26017.html#26055">26055</a></td>
<td class="comment-11" rowspan="1">Print the new score and make a sound effect.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26886"></span>26886</td>
<td class="bytes-0"></td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="26657.html">26657</a></span></td>
<td class="up">Up: <a href="../maps/all.html#26730">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="26887.html">26887</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Hungry Horace RAM disassembly 20190620</div>
<div class="copyright">&#169; 1982 Beam Software. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/686A.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>