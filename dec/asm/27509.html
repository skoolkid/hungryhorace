<!DOCTYPE html>
<html>
<head>
<title>Hungry Horace: Routine at 27509</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Hungry Horace" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="27464.html">27464</a>
</td>
<td class="up">Up: <a href="../maps/all.html#27509">Map</a></td>
<td class="next">
Next: <a href="27606.html">27606</a>
</td>
</tr>
</table>
<div class="description">27509: Draw the current maze</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="24576.html">24576</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">BC</td>
<td class="register-desc">768</td>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">16384</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address of the maze layout data (<a href="28663.html">28663</a>, <a href="29431.html">29431</a>, <a href="30199.html">30199</a> or <a href="30967.html">30967</a>)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="27509"></span>27509</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Save the tile counter.</td>
</tr>
<tr>
<td class="address-1"><span id="27510"></span>27510</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Save the maze layout data address.</td>
</tr>
<tr>
<td class="address-1"><span id="27511"></span>27511</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Transfer the display file address to <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="27512"></span>27512</td>
<td class="instruction">CALL <a href="27663.html">27663</a></td>
<td class="comment-1" rowspan="1">Set <span class="register">HL'</span> to the corresponding attribute file address (always 22528).</td>
</tr>
<tr>
<td class="address-1"><span id="27515"></span>27515</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Transfer the display file address back to <span class="register">DE</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="27516"></span>27516</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1">Exchange registers.</td>
</tr>
<tr>
<td class="address-1"><span id="27517"></span>27517</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the maze layout data address to <span class="register">DE'</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="27518"></span>27518</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the tile counter to <span class="register">BC'</span>.</td>
</tr>
<tr>
<td class="address-2"><span id="27519"></span>27519</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up a tile identifier.</td>
</tr>
<tr>
<td class="address-1"><span id="27520"></span>27520</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE'</span> at the next tile identifier.</td>
</tr>
<tr>
<td class="address-1"><span id="27521"></span>27521</td>
<td class="instruction">CP 0</td>
<td class="comment-1" rowspan="1">Is the current tile blank?</td>
</tr>
<tr>
<td class="address-1"><span id="27523"></span>27523</td>
<td class="instruction">JR Z,<a href="27509.html#27549">27549</a></td>
<td class="comment-1" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="address-1"><span id="27525"></span>27525</td>
<td class="instruction">CP 2</td>
<td class="comment-1" rowspan="1">Is the current tile a flower?</td>
</tr>
<tr>
<td class="address-1"><span id="27527"></span>27527</td>
<td class="instruction">JR Z,<a href="27509.html#27553">27553</a></td>
<td class="comment-1" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="address-1"><span id="27529"></span>27529</td>
<td class="instruction">CP 3</td>
<td class="comment-1" rowspan="1">Is the current tile an arrow (entrance or exit)?</td>
</tr>
<tr>
<td class="address-1"><span id="27531"></span>27531</td>
<td class="instruction">JR Z,<a href="27509.html#27541">27541</a></td>
<td class="comment-1" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="address-1"><span id="27533"></span>27533</td>
<td class="instruction">CP 9</td>
<td class="comment-1" rowspan="1">Is the current tile a tunnel entrance?</td>
</tr>
<tr>
<td class="address-1"><span id="27535"></span>27535</td>
<td class="instruction">JR Z,<a href="27509.html#27545">27545</a></td>
<td class="comment-1" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="address-1"><span id="27537"></span>27537</td>
<td class="instruction">LD A,61</td>
<td class="comment-1" rowspan="1">Wall tile (INK 5).</td>
</tr>
<tr>
<td class="address-1"><span id="27539"></span>27539</td>
<td class="instruction">JR <a href="27509.html#27555">27555</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="27541"></span>27541</td>
<td class="instruction">LD A,56</td>
<td class="comment-1" rowspan="1">Arrow tile (INK 0).</td>
</tr>
<tr>
<td class="address-1"><span id="27543"></span>27543</td>
<td class="instruction">JR <a href="27509.html#27555">27555</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="27545"></span>27545</td>
<td class="instruction">LD A,63</td>
<td class="comment-1" rowspan="1">Tunnel entrance (INK 7).</td>
</tr>
<tr>
<td class="address-1"><span id="27547"></span>27547</td>
<td class="instruction">JR <a href="27509.html#27555">27555</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="27549"></span>27549</td>
<td class="instruction">LD A,62</td>
<td class="comment-1" rowspan="1">Blank tile (INK 6).</td>
</tr>
<tr>
<td class="address-1"><span id="27551"></span>27551</td>
<td class="instruction">JR <a href="27509.html#27555">27555</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="27553"></span>27553</td>
<td class="instruction">LD A,60</td>
<td class="comment-1" rowspan="1">Flower (INK 4).</td>
</tr>
<tr>
<td class="address-2"><span id="27555"></span>27555</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Set the attribute byte.</td>
</tr>
<tr>
<td class="address-1"><span id="27556"></span>27556</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move <span class="register">HL'</span> along the attribute file.</td>
</tr>
<tr>
<td class="address-1"><span id="27557"></span>27557</td>
<td class="instruction">DEC BC</td>
<td class="comment-1" rowspan="1">Decrement the tile counter.</td>
</tr>
<tr>
<td class="address-1"><span id="27558"></span>27558</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="2">Have we finished setting the attribute bytes yet?</td>
</tr>
<tr>
<td class="address-1"><span id="27559"></span>27559</td>
<td class="instruction">OR C</td>
</tr>
<tr>
<td class="address-1"><span id="27560"></span>27560</td>
<td class="instruction">JR NZ,<a href="27509.html#27519">27519</a></td>
<td class="comment-1" rowspan="1">Jump back if not.</td>
</tr>
<tr>
<td class="address-1"><span id="27562"></span>27562</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1">Exchange registers.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27563"></span>
<div class="comments">
<div class="paragraph">
The attribute bytes have been set. Time to draw the maze tiles.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27563"></span>27563</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Save the maze layout pointer.</td>
</tr>
<tr>
<td class="address-1"><span id="27564"></span>27564</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick up a tile identifier in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="27565"></span>27565</td>
<td class="instruction">LD H,0</td>
<td class="comment-1" rowspan="9">Point <span class="register">IX</span> at the graphic data for the corresponding tile (at <a href="31735.html">31735</a>+8*<span class="register">A</span>).</td>
</tr>
<tr>
<td class="address-1"><span id="27567"></span>27567</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="27568"></span>27568</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="27569"></span>27569</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="27570"></span>27570</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="27571"></span>27571</td>
<td class="instruction">LD IX,<a href="31735.html">31735</a></td>
</tr>
<tr>
<td class="address-1"><span id="27575"></span>27575</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address-1"><span id="27576"></span>27576</td>
<td class="instruction">ADD IX,DE</td>
</tr>
<tr>
<td class="address-1"><span id="27578"></span>27578</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address-1"><span id="27579"></span>27579</td>
<td class="instruction">LD L,8</td>
<td class="comment-1" rowspan="7">Draw the tile.</td>
</tr>
<tr>
<td class="address-2"><span id="27581"></span>27581</td>
<td class="instruction">LD A,(IX+0)</td>
</tr>
<tr>
<td class="address-1"><span id="27584"></span>27584</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address-1"><span id="27585"></span>27585</td>
<td class="instruction">INC D</td>
</tr>
<tr>
<td class="address-1"><span id="27586"></span>27586</td>
<td class="instruction">INC IX</td>
</tr>
<tr>
<td class="address-1"><span id="27588"></span>27588</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="27589"></span>27589</td>
<td class="instruction">JR NZ,<a href="27509.html#27581">27581</a></td>
</tr>
<tr>
<td class="address-1"><span id="27591"></span>27591</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="5">Point <span class="register">DE</span> at the display file address for the next tile.</td>
</tr>
<tr>
<td class="address-1"><span id="27592"></span>27592</td>
<td class="instruction">JR Z,<a href="27509.html#27598">27598</a></td>
</tr>
<tr>
<td class="address-1"><span id="27594"></span>27594</td>
<td class="instruction">LD A,D</td>
</tr>
<tr>
<td class="address-1"><span id="27595"></span>27595</td>
<td class="instruction">SUB 8</td>
</tr>
<tr>
<td class="address-1"><span id="27597"></span>27597</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="address-2"><span id="27598"></span>27598</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the maze layout pointer to <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="27599"></span>27599</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move along to the next maze tile identifier.</td>
</tr>
<tr>
<td class="address-1"><span id="27600"></span>27600</td>
<td class="instruction">DEC BC</td>
<td class="comment-1" rowspan="1">Decrement the tile counter.</td>
</tr>
<tr>
<td class="address-1"><span id="27601"></span>27601</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="2">Have we drawn all the tiles yet?</td>
</tr>
<tr>
<td class="address-1"><span id="27602"></span>27602</td>
<td class="instruction">OR C</td>
</tr>
<tr>
<td class="address-1"><span id="27603"></span>27603</td>
<td class="instruction">JR NZ,<a href="27509.html#27563">27563</a></td>
<td class="comment-1" rowspan="1">Jump back if not.</td>
</tr>
<tr>
<td class="address-1"><span id="27605"></span>27605</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="27464.html">27464</a>
</td>
<td class="up">Up: <a href="../maps/all.html#27509">Map</a></td>
<td class="next">
Next: <a href="27606.html">27606</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Hungry Horace RAM disassembly 20221122</div>
<div class="copyright">&#169; 1982 Beam Software. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/6B75.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>