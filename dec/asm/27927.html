<!DOCTYPE html>
<html>
<head>
<title>Hungry Horace: Routine at 27927</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Hungry Horace" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="27898.html">27898</a></span></td>
<td class="up">Up: <a href="../maps/all.html#27927">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="27982.html">27982</a></span></td>
</tr>
</table>
<div class="description">27927: Get the location of the tile in front of a sprite</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="25399.html">25399</a>, <a href="25562.html">25562</a> and <a href="27842.html">27842</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Sprite animation frame</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Sprite location</td>
</tr>
</table>
<table class="output-1">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Location of the tile in front of the sprite</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="27927"></span>27927</td>
<td class="bytes-0"></td>
<td class="instruction">AND 3</td>
<td class="comment-11" rowspan="1">Keep only bits 0 and 1 of the animation frame (which indicate the direction that the sprite is facing). (This instruction is redundant.)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27929"></span>27929</td>
<td class="bytes-0"></td>
<td class="instruction">CP 0</td>
<td class="comment-11" rowspan="1">Is the sprite facing up?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27931"></span>27931</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="27927.html#27950">27950</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27933"></span>27933</td>
<td class="bytes-0"></td>
<td class="instruction">CP 1</td>
<td class="comment-11" rowspan="1">Is the sprite facing right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27935"></span>27935</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="27927.html#27962">27962</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27937"></span>27937</td>
<td class="bytes-0"></td>
<td class="instruction">CP 2</td>
<td class="comment-11" rowspan="1">Is the sprite facing down?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27939"></span>27939</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="27927.html#27971">27971</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27941"></span>
<div class="comments">
<div class="paragraph">
The sprite is facing left.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27941"></span>27941</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the tile to the left of the sprite's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27942"></span>27942</td>
<td class="bytes-0"></td>
<td class="instruction">JR NC,<a href="27927.html#27981">27981</a></td>
<td class="comment-11" rowspan="1">This jump is always made.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27944"></span>27944</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="4">This code is never executed.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27945"></span>27945</td>
<td class="bytes-0"></td>
<td class="instruction">SUB 8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27947"></span>27947</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27948"></span>27948</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="27927.html#27981">27981</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27950"></span>
<div class="comments">
<div class="paragraph">
The sprite is facing up.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="27950"></span>27950</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="7">Point <span class="register">HL</span> at the tile above the sprite's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27951"></span>27951</td>
<td class="bytes-0"></td>
<td class="instruction">SUB 32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27953"></span>27953</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27954"></span>27954</td>
<td class="bytes-0"></td>
<td class="instruction">JR NC,<a href="27927.html#27981">27981</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27956"></span>27956</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27957"></span>27957</td>
<td class="bytes-0"></td>
<td class="instruction">SUB 8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27959"></span>27959</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27960"></span>27960</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="27927.html#27981">27981</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27962"></span>
<div class="comments">
<div class="paragraph">
The sprite is facing right.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="27962"></span>27962</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="5">Point <span class="register">HL</span> at the tile to the right of the sprite's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27963"></span>27963</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,<a href="27927.html#27981">27981</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27965"></span>27965</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27966"></span>27966</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27968"></span>27968</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27969"></span>27969</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="27927.html#27981">27981</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27971"></span>
<div class="comments">
<div class="paragraph">
The sprite is facing down.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="27971"></span>27971</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="7">Point <span class="register">HL</span> at the tile below the sprite's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27972"></span>27972</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27974"></span>27974</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27975"></span>27975</td>
<td class="bytes-0"></td>
<td class="instruction">JR NC,<a href="27927.html#27981">27981</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27977"></span>27977</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27978"></span>27978</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27980"></span>27980</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="27981"></span>27981</td>
<td class="bytes-0"></td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="27898.html">27898</a></span></td>
<td class="up">Up: <a href="../maps/all.html#27927">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="27982.html">27982</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Hungry Horace RAM disassembly 20190620</div>
<div class="copyright">&#169; 1982 Beam Software. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/6D17.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>