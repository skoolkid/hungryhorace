<!DOCTYPE html>
<html>
<head>
<title>Hungry Horace: Routine at 26914</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Hungry Horace" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="26887.html">26887</a>
</td>
<td class="up">Up: <a href="../maps/all.html#26914">Map</a></td>
<td class="next">
Next: <a href="26988.html">26988</a>
</td>
</tr>
</table>
<div class="description">26914: Make a guard drop his lunch if necessary</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="26887.html">26887</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="26914"></span>26914</td>
<td class="instruction">LD A,(<a href="28088.html#28094">28094</a>)</td>
<td class="comment-1" rowspan="1">Pick up the guard's return delay counter.</td>
</tr>
<tr>
<td class="address-1"><span id="26917"></span>26917</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Has this guard been thrown out of the park?</td>
</tr>
<tr>
<td class="address-1"><span id="26918"></span>26918</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if so.</td>
</tr>
<tr>
<td class="address-1"><span id="26919"></span>26919</td>
<td class="instruction">LD E,4</td>
<td class="comment-1" rowspan="1">There are four maze background tiles to consider.</td>
</tr>
<tr>
<td class="address-1"><span id="26921"></span>26921</td>
<td class="instruction">LD HL,<a href="28088.html#28095">28095</a></td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the first maze background tile in the temporary guard buffer.</td>
</tr>
<tr>
<td class="address-2"><span id="26924"></span>26924</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the attribute byte of this maze background tile.</td>
</tr>
<tr>
<td class="address-1"><span id="26925"></span>26925</td>
<td class="instruction">CP 58</td>
<td class="comment-1" rowspan="1">Is there already a cherry or strawberry here?</td>
</tr>
<tr>
<td class="address-1"><span id="26927"></span>26927</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so.</td>
</tr>
<tr>
<td class="address-1"><span id="26928"></span>26928</td>
<td class="instruction">LD BC,9</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at the next maze background tile.</td>
</tr>
<tr>
<td class="address-1"><span id="26931"></span>26931</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="26932"></span>26932</td>
<td class="instruction">DEC E</td>
<td class="comment-1" rowspan="1">Have we checked all four tiles yet?</td>
</tr>
<tr>
<td class="address-1"><span id="26933"></span>26933</td>
<td class="instruction">JR NZ,<a href="26914.html#26924">26924</a></td>
<td class="comment-1" rowspan="1">Jump back if not.</td>
</tr>
<tr>
<td class="address-1"><span id="26935"></span>26935</td>
<td class="instruction">LD HL,(<a href="31845.html">31845</a>)</td>
<td class="comment-1" rowspan="3">Decrement the lunch-drop countdown timer.</td>
</tr>
<tr>
<td class="address-1"><span id="26938"></span>26938</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address-1"><span id="26939"></span>26939</td>
<td class="instruction">LD (<a href="31845.html">31845</a>),HL</td>
</tr>
<tr>
<td class="address-1"><span id="26942"></span>26942</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="2">Is it zero now?</td>
</tr>
<tr>
<td class="address-1"><span id="26943"></span>26943</td>
<td class="instruction">OR L</td>
</tr>
<tr>
<td class="address-1"><span id="26944"></span>26944</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if not.</td>
</tr>
<tr>
<td class="address-1"><span id="26945"></span>26945</td>
<td class="instruction">CALL <a href="27410.html">27410</a></td>
<td class="comment-1" rowspan="1">Generate a pseudo-random number in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="26948"></span>26948</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1">Copy it to <span class="register">L</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="26949"></span>26949</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Save <span class="register">L</span> briefly.</td>
</tr>
<tr>
<td class="address-1"><span id="26950"></span>26950</td>
<td class="instruction">CALL <a href="27410.html">27410</a></td>
<td class="comment-1" rowspan="1">Generate another pseudo-random number in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="26953"></span>26953</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">L</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="26954"></span>26954</td>
<td class="instruction">AND 3</td>
<td class="comment-1" rowspan="2">Reduce <span class="register">A</span> to 0, 1, 2 or 3 and copy it to <span class="register">H</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="26956"></span>26956</td>
<td class="instruction">LD H,A</td>
</tr>
<tr>
<td class="address-1"><span id="26957"></span>26957</td>
<td class="instruction">LD BC,800</td>
<td class="comment-1" rowspan="3">Add 800 and reset the lunch-drop countdown timer to this value.</td>
</tr>
<tr>
<td class="address-1"><span id="26960"></span>26960</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="26961"></span>26961</td>
<td class="instruction">LD (<a href="31845.html">31845</a>),HL</td>
</tr>
<tr>
<td class="address-1"><span id="26964"></span>26964</td>
<td class="instruction">CALL <a href="27410.html">27410</a></td>
<td class="comment-1" rowspan="1">Generate yet another pseudo-random number in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="26967"></span>26967</td>
<td class="instruction">AND 1</td>
<td class="comment-1" rowspan="1">Is bit 0 set?</td>
</tr>
<tr>
<td class="address-1"><span id="26969"></span>26969</td>
<td class="instruction">JR NZ,<a href="26914.html#26976">26976</a></td>
<td class="comment-1" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="address-1"><span id="26971"></span>26971</td>
<td class="instruction">LD HL,<a href="31868.html">31868</a></td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the sprite data for the cherry.</td>
</tr>
<tr>
<td class="address-1"><span id="26974"></span>26974</td>
<td class="instruction">JR <a href="26914.html#26979">26979</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="26976"></span>26976</td>
<td class="instruction">LD HL,<a href="31868.html#31904">31904</a></td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the sprite data for the strawberry.</td>
</tr>
<tr>
<td class="address-2"><span id="26979"></span>26979</td>
<td class="instruction">LD DE,<a href="28088.html#28095">28095</a></td>
<td class="comment-1" rowspan="3">Copy the cherry/strawberry sprite into the maze background tiles in the temporary guard buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="26982"></span>26982</td>
<td class="instruction">LD BC,36</td>
</tr>
<tr>
<td class="address-1"><span id="26985"></span>26985</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="address-1"><span id="26987"></span>26987</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="26887.html">26887</a>
</td>
<td class="up">Up: <a href="../maps/all.html#26914">Map</a></td>
<td class="next">
Next: <a href="26988.html">26988</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Hungry Horace RAM disassembly 20221122</div>
<div class="copyright">&#169; 1982 Beam Software. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/6922.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>