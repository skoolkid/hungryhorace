<!DOCTYPE html>
<html>
<head>
<title>Hungry Horace: Routine at 63DA</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="25399.html">6337</a></span></td>
<td class="up">Up: <a href="../maps/all.html#25562">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="25886.html">651E</a></span></td>
</tr>
</table>
<div class="description">63DA: Move a guard</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="25399.html">6337</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25562"></span>63DA</td>
<td class="instruction">LD A,(<a href="28088.html#28094">$6DBE</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's return delay counter.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25565"></span>63DD</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Has this guard been thrown out of the park?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25566"></span>63DE</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25567"></span>63DF</td>
<td class="instruction">LD HL,(<a href="31851.html">$7C6B</a>)</td>
<td class="comment-11" rowspan="1">Pick up Horace's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25570"></span>63E2</td>
<td class="instruction">RR H</td>
<td class="comment-11" rowspan="3">Now <span class="register">H</span>=0, 1 or 2, indicating which third of the screen the top row of Horace's sprite is in.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25572"></span>63E4</td>
<td class="instruction">RR H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25574"></span>63E6</td>
<td class="instruction">RR H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25576"></span>63E8</td>
<td class="instruction">LD B,$05</td>
<td class="comment-11" rowspan="4">Move bits 5-7 of <span class="register">L</span> down to bits 0-2, and bits 0-2 of <span class="register">H</span> into bits 3-5 of <span class="register">L</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25578"></span>63EA</td>
<td class="instruction">RR H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25580"></span>63EC</td>
<td class="instruction">RR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25582"></span>63EE</td>
<td class="instruction">DJNZ <a href="25562.html#25578">$63EA</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25584"></span>63F0</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="2">Now <span class="register">A</span>=Horace's screen y-coordinate (0-22).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25585"></span>63F1</td>
<td class="instruction">AND $1F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25587"></span>63F3</td>
<td class="instruction">LD HL,(<a href="31851.html">$7C6B</a>)</td>
<td class="comment-11" rowspan="1">Pick up Horace's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25590"></span>63F6</td>
<td class="instruction">LD H,A</td>
<td class="comment-11" rowspan="1"><span class="register">H</span>=Horace's screen y-coordinate (0-22).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25591"></span>63F7</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="3">Now <span class="register">L</span>=Horace's screen x-coordinate (0-30).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25592"></span>63F8</td>
<td class="instruction">AND $1F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25594"></span>63FA</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25595"></span>63FB</td>
<td class="instruction">LD (<a href="31866.html">$7C7A</a>),HL</td>
<td class="comment-11" rowspan="1">Save Horace's screen x- and y-coordinates temporarily.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25598"></span>63FE</td>
<td class="instruction">LD HL,(<a href="28088.html">$6DB8</a>)</td>
<td class="comment-11" rowspan="15">Compute the guard's screen x- and y-coordinates.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25601"></span>6401</td>
<td class="instruction">RR H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25603"></span>6403</td>
<td class="instruction">RR H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25605"></span>6405</td>
<td class="instruction">RR H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25607"></span>6407</td>
<td class="instruction">LD B,$05</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25609"></span>6409</td>
<td class="instruction">RR H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25611"></span>640B</td>
<td class="instruction">RR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25613"></span>640D</td>
<td class="instruction">DJNZ <a href="25562.html#25609">$6409</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25615"></span>640F</td>
<td class="instruction">LD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25616"></span>6410</td>
<td class="instruction">AND $1F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25618"></span>6412</td>
<td class="instruction">LD HL,(<a href="28088.html">$6DB8</a>)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25621"></span>6415</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25622"></span>6416</td>
<td class="instruction">LD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25623"></span>6417</td>
<td class="instruction">AND $1F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25625"></span>6419</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25626"></span>641A</td>
<td class="instruction">LD (<a href="28080.html">$6DB0</a>),HL</td>
<td class="comment-11" rowspan="1">Save the guard's screen x- and y-coordinates temporarily.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25629"></span>641D</td>
<td class="instruction">LD B,$04</td>
<td class="comment-11" rowspan="1">Initialise <span class="register">B</span> (the direction indicator) for the loop that follows.</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="25631"></span>
<div class="comments">
<div class="paragraph">
Four passes are made through the following loop, one for each direction the guard might go: left, down, right, or up.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25631"></span>641F</td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=3 (left), 2 (down), 1 (right) or 0 (up).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25632"></span>6420</td>
<td class="instruction">LD HL,(<a href="28088.html">$6DB8</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25635"></span>6423</td>
<td class="instruction">LD C,$00</td>
<td class="comment-11" rowspan="1">Initialise <span class="register">C</span> to 0; this is the direction probability parameter.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25637"></span>6425</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Save the direction indicator briefly.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25638"></span>6426</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1">Copy the direction indicator to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25639"></span>6427</td>
<td class="instruction">CALL <a href="27842.html">$6CC2</a></td>
<td class="comment-11" rowspan="1">Check the tiles next to the guard in that direction.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25642"></span>642A</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore the direction indicator to <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25643"></span>642B</td>
<td class="instruction">CP $02</td>
<td class="comment-11" rowspan="1">Is there a wall or the maze exit or entrance in that direction?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25645"></span>642D</td>
<td class="instruction">JP NC,<a href="25562.html#25795">$64C3</a></td>
<td class="comment-11" rowspan="1">Jump if so with <span class="register">C</span>=0: that direction is blocked.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25648"></span>6430</td>
<td class="instruction">LD C,$19</td>
<td class="comment-11" rowspan="1"><span class="register">C</span>=25; this value determines the base probability that the guard will turn 90 degrees in the direction indicated by <span class="register">B</span> when his path is blocked.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25650"></span>6432</td>
<td class="instruction">LD A,(<a href="28088.html#28090">$6DBA</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's animation frame.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25653"></span>6435</td>
<td class="instruction">CP B</td>
<td class="comment-11" rowspan="1">Is it equal to the current value of the direction indicator?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25654"></span>6436</td>
<td class="instruction">JR NZ,<a href="25562.html#25662">$643E</a></td>
<td class="comment-11" rowspan="1">Jump if not.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25656"></span>6438</td>
<td class="instruction">LD A,$28</td>
<td class="comment-11" rowspan="3"><span class="register">C</span>=65; this value ensures that the guard will keep moving in the same direction if he can.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25658"></span>643A</td>
<td class="instruction">ADD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25659"></span>643B</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25660"></span>643C</td>
<td class="instruction">JR <a href="25562.html#25691">$645B</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25662"></span>643E</td>
<td class="instruction">ADD A,$02</td>
<td class="comment-11" rowspan="2">Add 2 to the guard's current animation frame; this has the effect of toggling his direction between up/down and left/right.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25664"></span>6440</td>
<td class="instruction">AND $03</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25666"></span>6442</td>
<td class="instruction">CP B</td>
<td class="comment-11" rowspan="1">Is it equal to the current value of the direction indicator now?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25667"></span>6443</td>
<td class="instruction">JR NZ,<a href="25562.html#25675">$644B</a></td>
<td class="comment-11" rowspan="1">Jump if not.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25669"></span>6445</td>
<td class="instruction">LD A,$F6</td>
<td class="comment-11" rowspan="3"><span class="register">C</span>=15; this value determines the probability that the guard will turn round 180 degrees when his path is blocked.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25671"></span>6447</td>
<td class="instruction">ADD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25672"></span>6448</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25673"></span>6449</td>
<td class="instruction">JR <a href="25562.html#25691">$645B</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25675"></span>644B</td>
<td class="instruction">LD HL,($5C78)</td>
<td class="comment-11" rowspan="3">Increment the two least significant bytes of the system variable FRAMES, and copy the value to <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25678"></span>644E</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25679"></span>644F</td>
<td class="instruction">LD ($5C78),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25682"></span>6452</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="5">Use this value to generate a pseudo-random number between 0 and 31.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25683"></span>6453</td>
<td class="instruction">AND $0F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25685"></span>6455</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25686"></span>6456</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25687"></span>6457</td>
<td class="instruction">AND $1F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25689"></span>6459</td>
<td class="instruction">ADD A,C</td>
<td class="comment-11" rowspan="2">Add this to <span class="register">C</span>, giving a number between 25 and 56; the higher this value, the more likely the guard will turn 90 degrees in the direction indicated by <span class="register">B</span> when his path is blocked.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25690"></span>645A</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25691"></span>645B</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1">Copy the direction indicator to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25692"></span>645C</td>
<td class="instruction">CP $03</td>
<td class="comment-11" rowspan="1">Set the zero flag if we're considering 'left' at the moment.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25694"></span>645E</td>
<td class="instruction">LD A,(<a href="31844.html">$7C64</a>)</td>
<td class="comment-11" rowspan="1">Pick up the value of the redundant variable at <a href="31844.html">7C64</a>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25697"></span>6461</td>
<td class="instruction">JR NZ,<a href="25562.html#25703">$6467</a></td>
<td class="comment-11" rowspan="1">Jump if we're considering 'right', 'up' or 'down' at the moment.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25699"></span>6463</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="2">Decrement the redundant variable at <a href="31844.html">7C64</a>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25700"></span>6464</td>
<td class="instruction">LD (<a href="31844.html">$7C64</a>),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25703"></span>6467</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">This instruction is redundant.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25704"></span>6468</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1">Copy the direction indicator to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25705"></span>6469</td>
<td class="instruction">CP $00</td>
<td class="comment-11" rowspan="1">Are we considering 'up' at the moment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25707"></span>646B</td>
<td class="instruction">JR NZ,<a href="25562.html#25715">$6473</a></td>
<td class="comment-11" rowspan="1">Jump if not.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25709"></span>646D</td>
<td class="instruction">LD A,(<a href="31842.html">$7C62</a>)</td>
<td class="comment-11" rowspan="2">Reset the redundant variable at <a href="31844.html">7C64</a> to the value of the game speed parameter.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25712"></span>6470</td>
<td class="instruction">LD (<a href="31844.html">$7C64</a>),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25715"></span>6473</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1">Copy the direction indicator to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25716"></span>6474</td>
<td class="instruction">CP $00</td>
<td class="comment-11" rowspan="1">Are we considering 'up' at the moment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25718"></span>6476</td>
<td class="instruction">JR NZ,<a href="25562.html#25732">$6484</a></td>
<td class="comment-11" rowspan="1">Jump if not.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25720"></span>6478</td>
<td class="instruction">LD HL,(<a href="28080.html">$6DB0</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's screen x- and y-coordinates.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25723"></span>647B</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=guard's screen y-coordinate.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25724"></span>647C</td>
<td class="instruction">LD HL,(<a href="31866.html">$7C7A</a>)</td>
<td class="comment-11" rowspan="1">Pick up Horace's screen x- and y-coordinates.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25727"></span>647F</td>
<td class="instruction">SUB H</td>
<td class="comment-11" rowspan="1">Is Horace's y-coordinate greater than the guard's?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25728"></span>6480</td>
<td class="instruction">JR C,<a href="25562.html#25795">$64C3</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25730"></span>6482</td>
<td class="instruction">JR <a href="25562.html#25774">$64AE</a></td>
<td class="comment-11" rowspan="1">Otherwise jump to increase the probability that the guard will move up (towards Horace).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25732"></span>6484</td>
<td class="instruction">CP $01</td>
<td class="comment-11" rowspan="1">Are we considering 'right' at the moment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25734"></span>6486</td>
<td class="instruction">JR NZ,<a href="25562.html#25748">$6494</a></td>
<td class="comment-11" rowspan="1">Jump if not.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25736"></span>6488</td>
<td class="instruction">LD HL,(<a href="31866.html">$7C7A</a>)</td>
<td class="comment-11" rowspan="1">Pick up Horace's screen x- and y-coordinates.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25739"></span>648B</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Horace's screen x-coordinate.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25740"></span>648C</td>
<td class="instruction">LD HL,(<a href="28080.html">$6DB0</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's screen x- and y-coordinates.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25743"></span>648F</td>
<td class="instruction">SUB L</td>
<td class="comment-11" rowspan="1">Is the guard's x-coordinate greater than Horace's?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25744"></span>6490</td>
<td class="instruction">JR C,<a href="25562.html#25795">$64C3</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25746"></span>6492</td>
<td class="instruction">JR <a href="25562.html#25774">$64AE</a></td>
<td class="comment-11" rowspan="1">Otherwise jump to increase the probability that the guard will move right (towards Horace).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25748"></span>6494</td>
<td class="instruction">CP $02</td>
<td class="comment-11" rowspan="1">Are we considering 'down' at the moment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25750"></span>6496</td>
<td class="instruction">JR NZ,<a href="25562.html#25764">$64A4</a></td>
<td class="comment-11" rowspan="1">Jump if not.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25752"></span>6498</td>
<td class="instruction">LD HL,(<a href="31866.html">$7C7A</a>)</td>
<td class="comment-11" rowspan="1">Pick up Horace's screen x- and y-coordinates.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25755"></span>649B</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Horace's screen y-coordinate.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25756"></span>649C</td>
<td class="instruction">LD HL,(<a href="28080.html">$6DB0</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's screen x- and y-coordinates.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25759"></span>649F</td>
<td class="instruction">SUB H</td>
<td class="comment-11" rowspan="1">Is the guard's y-coordinate greater than Horace's?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25760"></span>64A0</td>
<td class="instruction">JR C,<a href="25562.html#25795">$64C3</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25762"></span>64A2</td>
<td class="instruction">JR <a href="25562.html#25774">$64AE</a></td>
<td class="comment-11" rowspan="1">Otherwise jump to increase the probability that the guard will move down (towards Horace).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25764"></span>64A4</td>
<td class="instruction">LD HL,(<a href="28080.html">$6DB0</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's screen x- and y-coordinates.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25767"></span>64A7</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=guard's screen x-coordinate.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25768"></span>64A8</td>
<td class="instruction">LD HL,(<a href="31866.html">$7C7A</a>)</td>
<td class="comment-11" rowspan="1">Pick up Horace's screen x- and y-coordinates.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25771"></span>64AB</td>
<td class="instruction">SUB L</td>
<td class="comment-11" rowspan="1">Is Horace's x-coordinate greater than the guard's?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25772"></span>64AC</td>
<td class="instruction">JR C,<a href="25562.html#25795">$64C3</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25774"></span>64AE</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">This instruction is redundant.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25775"></span>64AF</td>
<td class="instruction">ADD A,$0A</td>
<td class="comment-11" rowspan="1">Add 10 to <span class="register">A</span>; the higher the value <span class="register">A</span> holds now, the more likely the guard will move in the direction indicated by <span class="register">B</span> (towards Horace).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25777"></span>64B1</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">Save this probability modifier briefly.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25778"></span>64B2</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Save <span class="register">HL</span> (unnecessarily).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25779"></span>64B3</td>
<td class="instruction">LD HL,(<a href="28078.html">$6DAE</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard panic timer.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25782"></span>64B6</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="2">Set the zero flag unless the guards are panicking.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25783"></span>64B7</td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25784"></span>64B8</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25785"></span>64B9</td>
<td class="instruction">JR Z,<a href="25562.html#25792">$64C0</a></td>
<td class="comment-11" rowspan="1">Jump unless the guards are panicking.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25787"></span>64BB</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1">Restore the probability modifier to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25788"></span>64BC</td>
<td class="instruction">NEG</td>
<td class="comment-11" rowspan="1">Negate <span class="register">A</span>, making it less likely that the guard will move in the direction indicated by <span class="register">B</span> (towards Horace).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25790"></span>64BE</td>
<td class="instruction">JR <a href="25562.html#25793">$64C1</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25792"></span>64C0</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1">Restore the probability modifier to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25793"></span>64C1</td>
<td class="instruction">ADD A,C</td>
<td class="comment-11" rowspan="2">Now <span class="register">C</span> holds the probability parameter for the direction indicated by <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25794"></span>64C2</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25795"></span>64C3</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Save the direction indicator briefly.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25796"></span>64C4</td>
<td class="instruction">LD HL,<a href="28082.html">$6DB2</a></td>
<td class="comment-11" rowspan="4">Point <span class="register">HL</span> at one of the four slots at <a href="28082.html">6DB2</a>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25799"></span>64C7</td>
<td class="instruction">LD C,B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25800"></span>64C8</td>
<td class="instruction">LD B,$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25802"></span>64CA</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25803"></span>64CB</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore the direction indicator to <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25804"></span>64CC</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="2">Save the direction probability parameter in the appropriate slot.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25805"></span>64CD</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25806"></span>64CE</td>
<td class="instruction">INC B</td>
<td class="comment-11" rowspan="2">Have we considered every direction yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25807"></span>64CF</td>
<td class="instruction">DEC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25808"></span>64D0</td>
<td class="instruction">JP NZ,<a href="25562.html#25631">$641F</a></td>
<td class="comment-11" rowspan="1">Jump back if not.</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="25811"></span>
<div class="comments">
<div class="paragraph">
Having computed a direction probability parameter for each of the four slots at <a href="28082.html">6DB2</a>, we now use those values to determine the guard's next animation frame (and therefore direction of travel).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25811"></span>64D3</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="12">Compute in <span class="register">C</span> the index of the slot that holds the largest number (0, 1, 2 or 3).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25812"></span>64D4</td>
<td class="instruction">LD HL,$6DB6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25815"></span>64D7</td>
<td class="instruction">LD B,$04</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25817"></span>64D9</td>
<td class="instruction">DEC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25818"></span>64DA</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25819"></span>64DB</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25820"></span>64DC</td>
<td class="instruction">JR NC,<a href="25562.html#25824">$64E0</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25822"></span>64DE</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25823"></span>64DF</td>
<td class="instruction">LD C,B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25824"></span>64E0</td>
<td class="instruction">INC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25825"></span>64E1</td>
<td class="instruction">DEC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25826"></span>64E2</td>
<td class="instruction">JR NZ,<a href="25562.html#25817">$64D9</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25828"></span>64E4</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="2">Update the guard's animation frame to this index value.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25829"></span>64E5</td>
<td class="instruction">LD (<a href="28088.html#28090">$6DBA</a>),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25832"></span>64E8</td>
<td class="instruction">LD A,(<a href="28088.html#28090">$6DBA</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's animation frame.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25835"></span>64EB</td>
<td class="instruction">LD HL,(<a href="28088.html">$6DB8</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25838"></span>64EE</td>
<td class="instruction">CALL <a href="27842.html">$6CC2</a></td>
<td class="comment-11" rowspan="1">Check the tiles in front of the guard.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25841"></span>64F1</td>
<td class="instruction">CP $00</td>
<td class="comment-11" rowspan="1">Is there anything in front of the guard?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25843"></span>64F3</td>
<td class="instruction">JR Z,<a href="25562.html#25866">$650A</a></td>
<td class="comment-11" rowspan="1">Jump if not.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25845"></span>64F5</td>
<td class="instruction">CP $01</td>
<td class="comment-11" rowspan="1">Is the guard facing a tunnel entrance?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25847"></span>64F7</td>
<td class="instruction">JR NZ,<a href="25562.html#25879">$6517</a></td>
<td class="comment-11" rowspan="1">Jump if not.</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="25849"></span>
<div class="comments">
<div class="paragraph">
The guard is about to enter a tunnel.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25849"></span>64F9</td>
<td class="instruction">LD BC,(<a href="28623.html">$6FCF</a>)</td>
<td class="comment-11" rowspan="1">Pick up the the tunnel offset.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25853"></span>64FD</td>
<td class="instruction">LD A,(<a href="28088.html#28090">$6DBA</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's animation frame.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25856"></span>6500</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is it 0 (going up)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25857"></span>6501</td>
<td class="instruction">JR Z,<a href="25562.html#25863">$6507</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25859"></span>6503</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">Subtract the tunnel offset from the guard's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25861"></span>6505</td>
<td class="instruction">JR <a href="25562.html#25864">$6508</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25863"></span>6507</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">Add the tunnel offset to the guard's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25864"></span>6508</td>
<td class="instruction">JR <a href="25562.html#25875">$6513</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25866"></span>650A</td>
<td class="instruction">LD HL,(<a href="28088.html">$6DB8</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25869"></span>650D</td>
<td class="instruction">LD A,(<a href="28088.html#28090">$6DBA</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's animation frame.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25872"></span>6510</td>
<td class="instruction">CALL <a href="27927.html">$6D17</a></td>
<td class="comment-11" rowspan="1">Compute the guard's new location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25875"></span>6513</td>
<td class="instruction">LD (<a href="28088.html#28092">$6DBC</a>),HL</td>
<td class="comment-11" rowspan="1">Update the guard's location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25878"></span>6516</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="25879"></span>
<div class="comments">
<div class="paragraph">
The guard is facing a wall or the maze entrance or exit (so he cannot move).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25879"></span>6517</td>
<td class="instruction">LD HL,(<a href="28088.html">$6DB8</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25882"></span>651A</td>
<td class="instruction">LD (<a href="28088.html#28092">$6DBC</a>),HL</td>
<td class="comment-11" rowspan="1">Set the guard's new location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25885"></span>651D</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="25399.html">6337</a></span></td>
<td class="up">Up: <a href="../maps/all.html#25562">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="25886.html">651E</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Hungry Horace RAM disassembly 20171205</div>
<div class="copyright">&#169; 1982 Beam Software. &#169; 2017 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 6.1.</div>
</footer>
</body>
</html>