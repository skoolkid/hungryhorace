<!DOCTYPE html>
<html>
<head>
<title>Hungry Horace: Routine at 6922</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="26887.html">6907</a></span></td>
<td class="up">Up: <a href="../maps/all.html#26914">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="26988.html">696C</a></span></td>
</tr>
</table>
<div class="description">6922: Make a guard drop his lunch if necessary</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="26887.html">6907</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="26914"></span>6922</td>
<td class="instruction">LD A,(<a href="28088.html#28094">$6DBE</a>)</td>
<td class="comment-11" rowspan="1">Pick up the guard's return delay counter.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26917"></span>6925</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Has this guard been thrown out of the park?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26918"></span>6926</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26919"></span>6927</td>
<td class="instruction">LD E,$04</td>
<td class="comment-11" rowspan="1">There are four maze background tiles to consider.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26921"></span>6929</td>
<td class="instruction">LD HL,<a href="28088.html#28095">$6DBF</a></td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the first maze background tile in the temporary guard buffer.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="26924"></span>692C</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of this maze background tile.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26925"></span>692D</td>
<td class="instruction">CP $3A</td>
<td class="comment-11" rowspan="1">Is there already a cherry or strawberry here?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26927"></span>692F</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26928"></span>6930</td>
<td class="instruction">LD BC,$0009</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the next maze background tile.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26931"></span>6933</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26932"></span>6934</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="1">Have we checked all four tiles yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26933"></span>6935</td>
<td class="instruction">JR NZ,<a href="26914.html#26924">$692C</a></td>
<td class="comment-11" rowspan="1">Jump back if not.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26935"></span>6937</td>
<td class="instruction">LD HL,(<a href="31845.html">$7C65</a>)</td>
<td class="comment-11" rowspan="3">Decrement the lunch-drop countdown timer.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26938"></span>693A</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26939"></span>693B</td>
<td class="instruction">LD (<a href="31845.html">$7C65</a>),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26942"></span>693E</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="2">Is it zero now?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26943"></span>693F</td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26944"></span>6940</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26945"></span>6941</td>
<td class="instruction">CALL <a href="27410.html">$6B12</a></td>
<td class="comment-11" rowspan="1">Generate a pseudo-random number in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26948"></span>6944</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1">Copy it to <span class="register">L</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26949"></span>6945</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Save <span class="register">L</span> briefly.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26950"></span>6946</td>
<td class="instruction">CALL <a href="27410.html">$6B12</a></td>
<td class="comment-11" rowspan="1">Generate another pseudo-random number in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26953"></span>6949</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore <span class="register">L</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26954"></span>694A</td>
<td class="instruction">AND $03</td>
<td class="comment-11" rowspan="2">Reduce <span class="register">A</span> to 0, 1, 2 or 3 and copy it to <span class="register">H</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26956"></span>694C</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26957"></span>694D</td>
<td class="instruction">LD BC,$0320</td>
<td class="comment-11" rowspan="3">Add 800 and reset the lunch-drop countdown timer to this value.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26960"></span>6950</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26961"></span>6951</td>
<td class="instruction">LD (<a href="31845.html">$7C65</a>),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26964"></span>6954</td>
<td class="instruction">CALL <a href="27410.html">$6B12</a></td>
<td class="comment-11" rowspan="1">Generate yet another pseudo-random number in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26967"></span>6957</td>
<td class="instruction">AND $01</td>
<td class="comment-11" rowspan="1">Is bit 0 set?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26969"></span>6959</td>
<td class="instruction">JR NZ,<a href="26914.html#26976">$6960</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26971"></span>695B</td>
<td class="instruction">LD HL,<a href="31868.html">$7C7C</a></td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the sprite data for the cherry.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26974"></span>695E</td>
<td class="instruction">JR <a href="26914.html#26979">$6963</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="26976"></span>6960</td>
<td class="instruction">LD HL,<a href="31868.html#31904">$7CA0</a></td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the sprite data for the strawberry.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="26979"></span>6963</td>
<td class="instruction">LD DE,<a href="28088.html#28095">$6DBF</a></td>
<td class="comment-11" rowspan="3">Copy the cherry/strawberry sprite into the maze background tiles in the temporary guard buffer.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26982"></span>6966</td>
<td class="instruction">LD BC,$0024</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26985"></span>6969</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26987"></span>696B</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="26887.html">6907</a></span></td>
<td class="up">Up: <a href="../maps/all.html#26914">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="26988.html">696C</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Hungry Horace RAM disassembly 20171205</div>
<div class="copyright">&#169; 1982 Beam Software. &#169; 2017 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 6.1.</div>
</footer>
</body>
</html>