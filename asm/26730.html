<!DOCTYPE html>
<html>
<head>
<title>Hungry Horace: Routine at 686A</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="26657.html">6821</a></span></td>
<td class="up">Up: <a href="../maps/all.html#26730">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="26887.html">6907</a></span></td>
</tr>
</table>
<div class="description">686A: Draw the bell and check whether Horace has sounded the alarm</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="24576.html">6000</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="26730"></span>686A</td>
<td class="instruction">LD HL,(<a href="31851.html">$7C6B</a>)</td>
<td class="comment-11" rowspan="1">Pick up Horace's current location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26733"></span>686D</td>
<td class="instruction">LD BC,(<a href="31940.html">$7CC4</a>)</td>
<td class="comment-11" rowspan="1">Pick up the location of the bell in the current maze.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26737"></span>6871</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="2">Has Horace already sounded the alarm?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26738"></span>6872</td>
<td class="instruction">OR C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26739"></span>6873</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26740"></span>6874</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Clear the carry flag. (This instruction is redundant.)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26741"></span>6875</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">Subtract the bell's location from Horace's.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26743"></span>6877</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="2">Is Horace in exactly the same location as the bell?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26744"></span>6878</td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26745"></span>6879</td>
<td class="instruction">JR Z,<a href="26730.html#26814">$68BE</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26747"></span>687B</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="3">Is Horace one space to the left of the bell?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26748"></span>687C</td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26749"></span>687D</td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26750"></span>687E</td>
<td class="instruction">JR Z,<a href="26730.html#26814">$68BE</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26752"></span>6880</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="4">Is Horace one space to the right of the bell?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26753"></span>6881</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26754"></span>6882</td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26755"></span>6883</td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26756"></span>6884</td>
<td class="instruction">JR Z,<a href="26730.html#26814">$68BE</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26758"></span>6886</td>
<td class="instruction">LD BC,$0021</td>
<td class="comment-11" rowspan="4">Is Horace one space above the bell?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26761"></span>6889</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26762"></span>688A</td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26763"></span>688B</td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26764"></span>688C</td>
<td class="instruction">JR Z,<a href="26730.html#26814">$68BE</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26766"></span>688E</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">Clear the carry flag. (This instruction is redundant.)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26767"></span>688F</td>
<td class="instruction">LD BC,$0041</td>
<td class="comment-11" rowspan="4">Is Horace one space below the bell?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26770"></span>6892</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26772"></span>6894</td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26773"></span>6895</td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26774"></span>6896</td>
<td class="instruction">JR Z,<a href="26730.html#26814">$68BE</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="26776"></span>
<div class="comments">
<div class="paragraph">
Horace has not sounded the alarm.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26776"></span>6898</td>
<td class="instruction">LD HL,(<a href="31940.html">$7CC4</a>)</td>
<td class="comment-11" rowspan="1">Pick up the location of the bell in the current maze.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26779"></span>689B</td>
<td class="instruction">LD A,(<a href="31942.html">$7CC6</a>)</td>
<td class="comment-11" rowspan="3">Increment the bell's animation frame counter.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26782"></span>689E</td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26783"></span>689F</td>
<td class="instruction">LD (<a href="31942.html">$7CC6</a>),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26786"></span>68A2</td>
<td class="instruction">AND $38</td>
<td class="comment-11" rowspan="1">Keep only bits 3, 4 and 5.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26788"></span>68A4</td>
<td class="instruction">CP $1F</td>
<td class="comment-11" rowspan="1">Is the result 30 or less (i.e. bit 5 reset)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26790"></span>68A6</td>
<td class="instruction">JR C,<a href="26730.html#26794">$68AA</a></td>
<td class="comment-11" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26792"></span>68A8</td>
<td class="instruction">XOR $38</td>
<td class="comment-11" rowspan="1">Flip bits 3 and 4, and reset bit 5.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="26794"></span>68AA</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="4"><span class="register">BC</span>=4*<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26795"></span>68AB</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26796"></span>68AC</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26797"></span>68AD</td>
<td class="instruction">LD B,$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26799"></span>68AF</td>
<td class="instruction">LD DE,<a href="32519.html">$7F07</a></td>
<td class="comment-11" rowspan="1">This is the base address of the graphic data for the bell.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26802"></span>68B2</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="3">Point <span class="register">DE</span> at the graphic data for the appropriate bell sprite.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26803"></span>68B3</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26804"></span>68B4</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26805"></span>68B5</td>
<td class="instruction">CALL <a href="27663.html">$6C0F</a></td>
<td class="comment-11" rowspan="1">Set <span class="register">HL'</span> to the attribute file address of the bell's location.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26808"></span>68B8</td>
<td class="instruction">LD C,$3A</td>
<td class="comment-11" rowspan="1">This is the attribute byte (INK 2: PAPER 7).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26810"></span>68BA</td>
<td class="instruction">CALL <a href="27606.html">$6BD6</a></td>
<td class="comment-11" rowspan="1">Draw the bell.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26813"></span>68BD</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="26814"></span>
<div class="comments">
<div class="paragraph">
Horace has sounded the alarm.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="26814"></span>68BE</td>
<td class="instruction">LD HL,$0000</td>
<td class="comment-11" rowspan="2">Clear the bell location to indicate that Horace has sounded the alarm.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26817"></span>68C1</td>
<td class="instruction">LD (<a href="31940.html">$7CC4</a>),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26820"></span>68C4</td>
<td class="instruction">LD DE,<a href="32647.html">$7F87</a></td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the graphic data for the blank sprite.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26823"></span>68C7</td>
<td class="instruction">LD HL,(<a href="28623.html#28625">$6FD1</a>)</td>
<td class="comment-11" rowspan="1">Pick up the bell location for the current maze.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26826"></span>68CA</td>
<td class="instruction">CALL <a href="27663.html">$6C0F</a></td>
<td class="comment-11" rowspan="1">Set <span class="register">HL'</span> to the corresponding attribute file address.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26829"></span>68CD</td>
<td class="instruction">LD C,$3E</td>
<td class="comment-11" rowspan="1">This is the attribute byte (INK 6: PAPER 7).</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26831"></span>68CF</td>
<td class="instruction">CALL <a href="27606.html">$6BD6</a></td>
<td class="comment-11" rowspan="1">Draw the blank sprite where the bell was.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26834"></span>68D2</td>
<td class="instruction">CALL <a href="26657.html">$6821</a></td>
<td class="comment-11" rowspan="1">Draw Horace.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26837"></span>68D5</td>
<td class="instruction">LD HL,(<a href="31859.html">$7C73</a>)</td>
<td class="comment-11" rowspan="4">Add 60 to the score.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26840"></span>68D8</td>
<td class="instruction">LD BC,$003C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26843"></span>68DB</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26844"></span>68DC</td>
<td class="instruction">LD (<a href="31859.html">$7C73</a>),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26847"></span>68DF</td>
<td class="instruction">CALL <a href="26017.html#26055">$65C7</a></td>
<td class="comment-11" rowspan="1">Print the new score and make a sound effect.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26850"></span>68E2</td>
<td class="instruction">LD A,(<a href="31842.html">$7C62</a>)</td>
<td class="comment-11" rowspan="1">Pick up the game speed parameter in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26853"></span>68E5</td>
<td class="instruction">LD L,$00</td>
<td class="comment-11" rowspan="4"><span class="register">HL</span>=128*<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26855"></span>68E7</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26856"></span>68E8</td>
<td class="instruction">SRA H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26858"></span>68EA</td>
<td class="instruction">RR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26860"></span>68EC</td>
<td class="instruction">LD (<a href="28078.html">$6DAE</a>),HL</td>
<td class="comment-11" rowspan="1">Initialise the guard panic timer to this value.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26863"></span>68EF</td>
<td class="instruction">LD A,(<a href="28088.html#28090">$6DBA</a>)</td>
<td class="comment-11" rowspan="4">Update the animation frame in the temporary guard buffer; these instructions are redundant and have no effect on any of the guards.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26866"></span>68F2</td>
<td class="instruction">ADD A,$02</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26868"></span>68F4</td>
<td class="instruction">AND $03</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26870"></span>68F6</td>
<td class="instruction">LD (<a href="28088.html#28090">$6DBA</a>),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26873"></span>68F9</td>
<td class="instruction">LD HL,(<a href="31859.html">$7C73</a>)</td>
<td class="comment-11" rowspan="4">Add 150 to the score.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26876"></span>68FC</td>
<td class="instruction">LD BC,$0096</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26879"></span>68FF</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26880"></span>6900</td>
<td class="instruction">LD (<a href="31859.html">$7C73</a>),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26883"></span>6903</td>
<td class="instruction">CALL <a href="26017.html#26055">$65C7</a></td>
<td class="comment-11" rowspan="1">Print the new score and make a sound effect.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="26886"></span>6906</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="26657.html">6821</a></span></td>
<td class="up">Up: <a href="../maps/all.html#26730">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="26887.html">6907</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Hungry Horace RAM disassembly 20171205</div>
<div class="copyright">&#169; 1982 Beam Software. &#169; 2017 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 6.1.</div>
</footer>
</body>
</html>